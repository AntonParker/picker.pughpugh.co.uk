<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HTML Colour Picker</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Armata' rel='stylesheet' type='text/css'>

    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript">
        $(document).ready( function(){
            var width   = $(window).width()  - 20,
                height  = $(window).height() - 100,
                wrapper = $('#picker');

            wrapper.append('<canvas id="pickerCanvas" width="'+width+'px" height="'+height+'px"></canvas>');

            doLayout();

            var resizeTimer;

            $(window).resize(function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function(){
                    clearLayout();
                    doLayout();   
                }, 100);
            });
        });

        function clearLayout(){
            var canvas = $("#pickerCanvas")[0];
            var ctx    = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        };

        function doLayout(){
            var width   = $(window).width()  - 20,
                height  = $(window).height() - 100;

            var canvas   = $("#pickerCanvas")[0],
                context  = canvas.getContext("2d");
                tileSize = Math.floor( Math.sqrt( ( ( width * height ) / 216 ) ) * 0.485 ),
                offset   = 0,
                x = y = 1;

            context.canvas.width  = width;
            context.canvas.height = height;

            $.each( webSafeColours(), function( i, colour ){
                drawPolygon(context, 6, colour, x, y, tileSize );

                x += tileSize * 3.6;

                if( x >= $("#picker").width() - tileSize * 2 ){
                    y += tileSize + 2;
                    offset = ( offset === 0 ) ? 1.8 : 0;
                    x = (tileSize * offset) + 1;
                }
            });
        };

        function drawPolygon(ctx, sides, colour, x, y, size){
            var Xcenter = x + size,
                Ycenter = y + size;

            var hexColour = rgbToHex( colour[0], colour[1], colour[2] );
            
            ctx.save(); 
            ctx.beginPath();
            ctx.moveTo (Xcenter +  size * Math.cos(0), Ycenter +  size *  Math.sin(0));          
            
            for (var i = 1; i <= sides; i++) {
                ctx.lineTo (Xcenter + size * Math.cos(i * 2 * Math.PI / sides), Ycenter + size * Math.sin(i * 2 * Math.PI / sides));
            }

            ctx.shadowBlur  = 4;
            ctx.shadowColor = '#999';
            ctx.fillStyle   = hexColour;
            ctx.strokeStyle = "#000000";
            ctx.lineWidth   = 1;

            ctx.fill();
            ctx.stroke();
            ctx.restore();

            ctx.font         = Math.ceil(size / 2.5) + "px Courier";
            ctx.textAlign    = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle    = ( lightOrDark(  colour[0], colour[1], colour[2] ) === 'dark' ) ? '#FFF' : '#000' ;

            ctx.fillText( hexColour, x + size , y + size );
        }

        function drawSquare(ctx, colour, x, y , size){
            ctx.fillStyle = colour;
            ctx.fillRect( x, y, size, size );
            ctx.font="10px Courier";
            ctx.fillText( colour, x + 2 , y + 2);
        }

        function webSafeColours(){
            var colours = [];

            for( var red = 255; red >= 0; red -= 51 ){
                for( var green = 255; green >= 0; green -= 51 ){
                    for( var blue = 255; blue >= 0; blue -= 51 ){
                        colours.push( [ red, green, blue ] );
                    }
                }
            }
            return colours.sort( function(b,a){
                return rgbToHsv(a[0], a[1], a[0])[2] - rgbToHsv(b[0], b[1], b[0])[2];
            });
        }

        function rgbToHex( r, g, b ){
            var colour = '#',
                hr     = ( 0 + r.toString(16) ).substr(-2),
                hg     = ( 0 + g.toString(16) ).substr(-2),
                hb     = ( 0 + b.toString(16) ).substr(-2);

            if ( hr.charAt(0) === hr.charAt(1) &&
                 hg.charAt(0) === hg.charAt(1) &&
                 hb.charAt(0) === hb.charAt(1)    ){
                colour += hr.charAt(0) + hg.charAt(0) + hb.charAt(0);
            }
            else{
                colour += hr + hg + hb;
            }

            return colour.toUpperCase();
        }

        function rgbToHsv(r, g, b){
            r = r/255, g = g/255, b = b/255;
            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h, s, v = max;
        
            var d = max - min;
            s = max == 0 ? 0 : d / max;
        
            if(max == min){
                h = 0; // achromatic
            }else{
                switch(max){
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
        
            return [h, s, v];
        }

        function lightOrDark (r, g, b) {
            var brightness = (r * 299) + (g * 587) + (b * 114);
            brightness = brightness / 255000;
            return ( brightness >= 0.5 ) ? 'light' : 'dark';
        }
    </script>
    <style>
        body {
            padding: 0px;
            margin: 0px;
            font-family: 'Armata', sans-serif;
            background-image: url('bg.png');
        }

        #wrapper {
            width: 100%; 
            background-color: #EEE;
        }

        #header {
            -moz-box-shadow: 0px 0px 6px #666;
            -webkit-box-shadow: 0px 0px 6px #666;
            box-shadow: 0px 0px 6px #666;
        }

        #header h1 { 
            padding: 4px 10px 4px 10px;
            margin: 0px;
            background-color: #000;
            color: #FFF;
            font-size: 20px;
        }

        #footer {
            height: 20px;
            text-align: right;
            font-size: 10px;
            padding: 0px 10px 0px 10px;
        }

        #picker {
            padding: 10px;
            margin-bottom: 6px;
            -moz-box-shadow: 0px 0px 6px #666;
            -webkit-box-shadow: 0px 0px 6px #666;
            box-shadow: 0px 0px 6px #666;
        }

    </style>
</head>
<body>
    <div id="wrapper">
        <div id="header">
            <h1>Colour Picker</h1>
        </div>
        <div id="picker"></div>
    </div>
    <div id="footer">
        Made by <a href="http://www.hughgallagher.co.uk">Hugh Gallagher</a>
    </div>
</body>
</html>
